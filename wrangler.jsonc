{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "claude-code-containers",
  "main": "src/index.ts",
  "compatibility_date": "2025-05-23",
  "compatibility_flags": ["nodejs_compat"],
  "observability": {
    "enabled": true,
  },
  "containers": [
    {
      "class_name": "MyContainer",
      "image": "./Dockerfile",
      "max_instances": 10,
    },
  ],
  "durable_objects": {
    "bindings": [
      {
        "class_name": "MyContainer",
        "name": "MY_CONTAINER",
      },
      {
        "class_name": "GitHubAppConfigDO",
        "name": "GITHUB_APP_CONFIG",
      },
      {
        "class_name": "UserConfigDO",
        "name": "USER_CONFIG",
      },
      {
        "class_name": "ACPSessionDO",
        "name": "ACP_SESSION",
      },
      {
        "class_name": "AsyncJobDO",
        "name": "ASYNC_JOB",
      },
    ],
  },
  "migrations": [
    {
      "new_sqlite_classes": ["MyContainer", "GitHubAppConfigDO"],
      "tag": "v1",
    },
    {
      "new_sqlite_classes": ["UserConfigDO"],
      "tag": "v2",
    },
    {
      "new_sqlite_classes": ["ACPSessionDO"],
      "tag": "v3",
    },
    {
      "new_sqlite_classes": ["AsyncJobDO"],
      "tag": "v4",
    },
  ],
  "build": {
    "command": "npm run build:all",
  },
  "vars": {
    "ENVIRONMENT": "development",
    "ENABLE_DEEP_REASONING": "false",
    // Container Provider: "cloudflare" (default) or "daytona"
    // ⚠️ Choose once and stick with it - switching causes context loss!
    "CONTAINER_PROVIDER": "cloudflare",
    // Daytona-specific values (required only when CONTAINER_PROVIDER=daytona)
    // DAYTONA_API_URL is provided by LumiLink infrastructure
    "DAYTONA_API_URL": "https://api.daytona.io",
    // User-provided secrets (set via GitHub Actions secrets)
    "DAYTONA_API_KEY": "",
    "DAYTONA_ORGANIZATION_ID": "",
  },
  "env": {
    "production": {
      "name": "claude-code-containers-production",
      "vars": {
        "ENVIRONMENT": "production",
        "ENABLE_DEEP_REASONING": "false",
        "CONTAINER_PROVIDER": "cloudflare",
        "DAYTONA_API_URL": "https://api.daytona.io",
        "DAYTONA_API_KEY": "",
        "DAYTONA_ORGANIZATION_ID": "",
      },
      "containers": [
        {
          "class_name": "MyContainer",
          "image": "./Dockerfile",
          "max_instances": 10,
        },
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "MyContainer",
            "name": "MY_CONTAINER",
          },
          {
            "class_name": "GitHubAppConfigDO",
            "name": "GITHUB_APP_CONFIG",
          },
          {
            "class_name": "UserConfigDO",
            "name": "USER_CONFIG",
          },
          {
            "class_name": "ACPSessionDO",
            "name": "ACP_SESSION",
          },
          {
            "class_name": "AsyncJobDO",
            "name": "ASYNC_JOB",
          },
        ],
      },
    },
    "development": {
      "name": "claude-code-containers-dev",
      "vars": {
        "ENVIRONMENT": "development",
        "ENABLE_DEEP_REASONING": "false",
        "CONTAINER_PROVIDER": "cloudflare",
        "DAYTONA_API_URL": "https://api.daytona.io",
        "DAYTONA_API_KEY": "",
        "DAYTONA_ORGANIZATION_ID": "",
      },
      "containers": [
        {
          "class_name": "MyContainer",
          "image": "./Dockerfile",
          "max_instances": 10,
        },
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "MyContainer",
            "name": "MY_CONTAINER",
          },
          {
            "class_name": "GitHubAppConfigDO",
            "name": "GITHUB_APP_CONFIG",
          },
          {
            "class_name": "UserConfigDO",
            "name": "USER_CONFIG",
          },
          {
            "class_name": "ACPSessionDO",
            "name": "ACP_SESSION",
          },
          {
            "class_name": "AsyncJobDO",
            "name": "ASYNC_JOB",
          },
        ],
      },
    },
    "staging": {
      "name": "claude-code-containers-staging",
      "vars": {
        "ENVIRONMENT": "staging",
        "ENABLE_DEEP_REASONING": "false",
        "CONTAINER_PROVIDER": "cloudflare",
        "DAYTONA_API_URL": "https://api.daytona.io",
        "DAYTONA_API_KEY": "",
        "DAYTONA_ORGANIZATION_ID": "",
      },
      "containers": [
        {
          "class_name": "MyContainer",
          "image": "./Dockerfile",
          "max_instances": 10,
        },
      ],
      "durable_objects": {
        "bindings": [
          {
            "class_name": "MyContainer",
            "name": "MY_CONTAINER",
          },
          {
            "class_name": "GitHubAppConfigDO",
            "name": "GITHUB_APP_CONFIG",
          },
          {
            "class_name": "UserConfigDO",
            "name": "USER_CONFIG",
          },
          {
            "class_name": "ACPSessionDO",
            "name": "ACP_SESSION",
          },
          {
            "class_name": "AsyncJobDO",
            "name": "ASYNC_JOB",
          },
        ],
      },
    },
  },
}
