@startuml Current vs Proposed Architecture
!include ../_style-common.puml

title Current vs Proposed Architecture Comparison

left to right direction

package "Current Architecture\n(Monolithic)" <<Rectangle>> #ffe6e6 {
  
  component "index.ts\n1,675 LOC" as CurrentIndex #e74c3c {
    [Routing]
    [Validation]
    [Business Logic]
    [DB Access]
    [API Calls]
  }
  
  component "user-config-do.ts\n801 LOC" as CurrentDO #e74c3c {
    [Storage]
    [Encryption]
    [Validation]
    [Business Rules]
  }
  
  component "user-endpoints.ts\n566 LOC" as CurrentEndpoints #e74c3c {
    [HTTP Handling]
    [Validation]
    [Business Logic]
    [Response]
  }
  
  note right of CurrentIndex
    ❌ **Problems:**
    - Too many responsibilities
    - Hard to test
    - Tight coupling
    - No separation of concerns
    - Difficult to maintain
  end note
}

package "Proposed Architecture\n(Clean Architecture)" <<Rectangle>> #e6ffe6 {
  
  package "Core\n~1,200 LOC" as Core #3498db {
    component "Entities\n~300 LOC" as Entities
    component "Use Cases\n~900 LOC" as UseCases
  }
  
  package "API\n~1,500 LOC" as API #f39c12 {
    component "Controllers\n~600 LOC" as Controllers
    component "Routes\n~300 LOC" as Routes
    component "Middleware\n~400 LOC" as Middleware
    component "DTOs\n~200 LOC" as DTOs
  }
  
  package "Infrastructure\n~2,800 LOC" as Infra #2ecc71 {
    component "Durable Objects\n~1,500 LOC" as DOs
    component "Services\n~1,000 LOC" as Services
    component "Adapters\n~300 LOC" as Adapters
  }
  
  package "Shared\n~500 LOC" as Shared #9b59b6 {
    component "Types\n~200 LOC" as Types
    component "Errors\n~150 LOC" as Errors
    component "Utils\n~150 LOC" as Utils
  }
  
  Controllers ..> UseCases : uses
  UseCases ..> Entities : uses
  DOs ..|> UseCases : implements interfaces
  Services ..|> UseCases : implements interfaces
  
  note right of Core
    ✅ **Benefits:**
    - Single Responsibility
    - Easy to test (mock interfaces)
    - Loose coupling
    - Clear boundaries
    - Maintainable & Scalable
  end note
}

note bottom
  **Key Differences:**
  
  | Aspect | Current | Proposed |
  |--------|---------|----------|
  | Files | ~15 large files | ~40 small files |
  | Avg LOC/file | ~400-800 | ~50-150 |
  | Test Coverage | ~30% | ~80% target |
  | Add Feature | Modify 5-10 files | Add 2-3 new files |
  | Coupling | High | Low |
  | Maintainability | Hard | Easy |
end note

@enduml
